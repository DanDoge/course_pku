#计算机的启动

##体系结构概述

CPU --总线-- I/O, 内存

##内存硬盘布局

内存: 0 -- 空闲 -640k- bios(功能: 基本io, 系统设置, 自检程序, 自启动程序) -1M- 空闲 -- 4G
硬盘: 加载程序, os
系统处于保护模式(实模式), 地址计算: 段地址左移四位 + 偏移量, 20位地址空间(1M)
加载加载程序(隔离os与固件, 应对多个os, 空间), 加载程序加载os
bios找到加载程序:

###bios系统调用

int 10h: 字符显示
int 13h: 磁盘扇区读写
int 15h: 检测内存大小
int 16h: 键盘输入

只能x86下实模式下调用

##启动流程

通电, 读取bios, 初始化硬件, 硬件检查, 检查引导设备第一个扇区(主引导记录), 加载在0x7c00, 控制权交给os

###主引导记录

启动代码(446字节), 硬盘分区表(64字节), 分区引导扇区格式

#os运行环境

##CPU

主控制器, 运算器, 寄存器, cache
用户可见寄存器(数据, 地址, 条件码, 机器语言可以直接引用), 控制和状态寄存器(控制处理器的操作, 特权级别下可以访问修改, pc, ir(instruction reg.), psw(program status word))

##os需求

保护: 管理资源, 并发 共享
指令的特权, 硬件将os和用户程序隔离, 用户可见/不可见

cpu状态分为(大致)两种, 用户态, 内核态, psw中设置一位,标志不同的状态
特权指令, 非特权指令(那些?)

x86: r0 --- r3, 但os大多只用两个

用户 --> 内核: 中断异常
内核 --> 用户: 设置psw

##存储系统

层次结构, 局部性原理
cache对os不可见

##io控制技术

程序控制(每隔一段时间查询, 轮询), 中断驱动(结束发信号), 直接存储器存取(DMA)

##时钟

周期性信号源, 处理延时, 超时, 定时
绝对时钟, 相对时钟(倒计时), 硬件时钟, 软件时钟
x86定时硬件(读ppt)

#课后补充

实模式: 物理地址seg << 4 + offset, 其中seg和offset都是16位的, 每一个段固定大小64k, 可以切换到保护模式, 但是不能切回来
保护模式: 段值存在16位段寄存器中, 作为一个索引, 去找段描述符表项(GDT), 提供对段的保护机制, 最大寻址4G

CPU读的第一条指令: 0xffff0, cs:ip = 0xf000: fff0, 是一条跳转指令, 初始状态是16位实模式

主引导记录

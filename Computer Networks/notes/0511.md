### TCP可靠传输

链路层可靠传输

- 相邻节点之间没有错序问题
- 两次握手，状态同步
    - 拥塞导致丢失/延迟的话会受到重复数据
    - 解决方法：限制最大延迟 -> 限制网络规模
    - 跳数计数器 -> 破坏了分层结构，路由器检测传输层数据段
    - 时间戳，丢弃过时的报文 -> 路由器之间同步
    - 以上的方式都不可行

网络层可靠传输

- 数据包方式没有解决错序的问题



可靠传输连接建立

- 接收端判定重复报文？规定报文的生存期，用序号做标记，生存期内序号只能用一次
    - 序号唯一？宕机了怎么办：基于系统时钟设置初始序号，现代TCP伪随机初始序号
    - 三次握手：发方知道收方的序号



连接释放

- 三次释放最后的ACK丢失怎么办
    - 四次挥手



TCP

- 端到端的可靠字节流
- 设置窗口值
- 报文格式：源/目的端口，序号，确认号，窗口，检验和，选项（e.g. 时间戳，估计RTT）
- 连接管理：三次握手，连接拆除（任何一方都可结束连接，释放自己方向的连接，对方没有要发的就可以拆除了）
- 流量控制：基于字节的大缓存，报文长度可变
    - 发端被死锁怎么办？发端发送消息强制确认窗口
    - 延迟50ms稍待确认，或者禁止发端发送太短的报文/收端通报太小的缓存